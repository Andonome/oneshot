
% Check if 'adventures in fenestra' is present in directory aif.
% If it is, set up a toggle 'aif', and make it true.
% Repeat for 'core'.
\externalReferent{aif}
\externalReferent{core}
\externalReferent{stories}
\externalReferent{judgement}

\newtoggle{hardcore}
\newtoggle{oneshot}

\ifStrSame{\jobname}{hardcore_horde_escape}%
  {\settoggle{hardcore}{true}}%
  {\ifStrSame{\jobname}{oneshot_horde_escape}%
    {\settoggle{oneshot}{true}
    \settoggle{verbose}{false}
    }{}
  }

\ifStrSame{\jobname}{handouts_hardcore}%
  {\settoggle{hardcore}{true}}%
  {\ifStrSame{\jobname}{handouts_oneshot}%
    {\settoggle{oneshot}{true}}{}}

% When 'examplecharacter' = true, some stats show more information about how they work.
\iftoggle{oneshot}{
  \settoggle{examplecharacter}{true}{}
}

\newcounter{enemyNo}

\iftoggle{hardcore}{
  \setcounter{enemyNo}{8}
}{
  \setcounter{enemyNo}{4}
}

\newenvironment{baseNote}[1]{

  \begin{figure*}[b!]

  \setcounter{enc}{\value{list}}
  \bigLine
  \subsection{#1}
  \setcounter{list}{\value{enc}}

  \begin{multicols}{2}
  \setlength\parindent{24pt}

}{

  \end{multicols}

  \end{figure*}

}


\newcommand{\newRule}[2]{

  \iftoggle{oneshot}{
    \begin{baseNote}{New Rule: #1}

    #2
    \end{baseNote}
  }{}

}


% Goblins should have torches.

\renewcommand{\goblin}[1][\npc{\T[\arabic{r3b}]\N}{\arabic{r3b} Goblins}]{
  \randomthreeB
	#1
	\randomtwo
	\randomtwoB
	\addtocounter{r2b}{-2}
	\addtocounter{enc}{1}
  \randomthree
  \randomthreeC
    \setcounter{gold}{\value{r3c}}
    \addtocounter{gold}{-2}
	\randomdozen
	\randomfourB
\person{\arabic{r2b}}% STRENGTH
{\arabic{r2}}% DEXTERITY 
{\arabic{enc}}% SPEED
{{\arabic{gold}}% INTELLIGENCE
{0}% WITS
{-4}}% CHARISMA
{0}% DR
{\arabic{r2}}% COMBAT
{\iftoggle{hardcore}{Projectiles~\arabic{r2},}{} Athletics~1, Deceit~1, Stealth~\arabic{r3}, \ifodd\value{r4}Tactics~\arabic{r2}\fi%
}% SKILLS
{\ifodd\value{r2}%
	\Dagger, Candle%
\else%
	\ifodd\value{r12}%
		\javelin, dagger%
	\else%
		\Dagger%
	\fi%
\fi%
\ifodd\value{r3b}%
	\ifnum\value{noAppearing}=1
		, tinder box%
	\fi%
\fi%
.}% EQUIPMENT
{}
}


\newcommand{\armouredOgre}[1][\npc{\M\N}{Armoured Ogre}]{
  #1
  \person{\iftoggle{oneshot}{5}{6}}% STRENGTH
  {0}% DEXTERITY 
  {4}% SPEED
  {{-3}% INTELLIGENCE
  {0}% WITS
  {-3}}% CHARISMA
  {0}% DR
  {1}% COMBAT
  {Crafts~1, Vigilance~2}% SKILLS
  {\greatsword, \partialleather}% EQUIPMENT
  {}
}


\newcommand{\prisoner}[1][\NPC{\Hu\F}{Random Villager}{Pessimistic}{Scratches nose}{Tribe}]{
	#1
	\randomthree
  \addtocounter{age}{-1}
	\randomthreeB
	\randomthreeC
    \setcounter{enc}{\value{r3c}}
    \addtocounter{enc}{-2}
	\randomtwo
	\randomtwoB
    \setcounter{list}{\value{r2b}}
    \addtocounter{r2b}{-1}
	\randomtwoC
  \randomdozen
\person{\arabic{age}}% STRENGTH
{0}% DEXTERITY 
{0}% SPEED
{{\arabic{enc}}% INTELLIGENCE
{-1}% WITS
{0}}% CHARISMA
{0}% DR
{\ifodd\value{r3b} 0\else 1\fi}% COMBAT
{\ifnum\value{r3}=1 Projectiles~1, \fi \ifnum\value{r3c}=3 Deceit\else Crafts\fi~\arabic{r2c}, \ifodd\value{r3}\else Vigilance~1, \fi Wyldcrafting~\arabic{r2}}% SKILLS
{Nothing}% EQUIPMENT
{}
}

\newcommand\noteRaidingParty{
  \begin{baseNote}{The Raiding Party}
  \label{raidingParty}

  \paragraph{If the \glspl{pc} decide to stop and rest,}
  \iftoggle{hardcore}{%
    they are immediately interrupted by a returning raiding party of nura, with fresh prisoners.
  }{
    they will be able to recovery for a while,\footnote{As usual, they recover Fatigue Points equal to half their current \glspl{hp}, and 40\% of their base \glspl{fp}.} before a raiding party descends with freshly captured prisoners.
  }

  The lift (room \ref{lift}) cannot take the full weight of an ogre plus the prisoners, so one goblin nuramancer and an ogre go to the bottom, then the prisoners get shoved in the lift by ogres at the top.

  \begin{boxtext}
    A creaking noise comes from the two wooden doors, then you hear loud voices from inside.

    ``\textit{My guts! That old lady didn't agree with me}'',
    you hear a deep voice saying.

    ``\textit{Did you do an argument?}'', a shrill voice replies.
    
    You hear a loud `\textbf{bang!}', then the wooden doors open.

  \end{boxtext}

  \iftoggle{hardcore}{%
    \goblinnuramancer[\npc{\M\N}{Goblin Nuramancer}]
    \showStdSpells
  }{
    \iftoggle{oneshot}{
      \goblin[\npc{\N\F}{Goblin}]
    }{
      \goblin[\npc{\T[2]\N}{2 Goblins}]
    }
  }

  \iftoggle{oneshot}{
    \ogre[\npc{\N\Hu}{Ogre}]
  }{
    \armouredOgre
  }

  \paragraph{If any \glspl{pc} have died,}
  this is a good time to give out new characters from the recently captured prisoners.

  \paragraph{If the \glspl{pc} try to hide,}
  they will find it easy.

  \paragraph{If they try to ambush the nura,}
  give them a Wits + Stealth (\gls{tn} 8) roll to determine the best location to stand.

  Success means they can each make one attack roll at \gls{tn} 7 (not the creature's usual attack score) with +2 Damage.

  \paragraph{Once the farmers come down,}
  they are tired, and have 8 Fatigue Points each, so any Damage they receive will quickly rack up penalties.

  Take the farmer statblocks from the handout, cut them apart from each other, and hand \iftoggle{hardcore}{2}{3} to the players to keep track of.
  \iftoggle{oneshot}{
    The farmers will refuse to go first into any combat situation, if the characters fight first then they can make a Morale Check to join.
  }{}

  Shortly after, two more ogres come down to find out where the last people went.

  \pic{Decky/screech}

  \end{baseNote}


}
